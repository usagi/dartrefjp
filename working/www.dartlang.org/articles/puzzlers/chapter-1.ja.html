<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<title>Dart ぱずらーず 1 : Dart : 構造化ウェブプログラミング</title>
	
 
	
 
  
 

 

 

 

 

		
 

  <ul>
    <li><a href="/downloads.html">Downloads</a></li>
    <li><a href="http://news.dartlang.org">News &amp; Updates</a></li>
    <li>Getting Started
      <ul>
        <li><a href="/language-tour/">Language Tour</a></li>
        <li><a href="/docs/technical-overview/">Technical Overview</a></li>
        <li><a href="http://synonym.dartlang.org">Translations from JavaScript</a></li>
      </ul> </li>
    <li>Language &amp; Libraries
      <ul>
        <li><a href="/docs/spec/">Language Spec</a></li>
        <li><a href="http://api.dartlang.org/">API Reference</a></li>
      </ul> </li>
    <li>Tools
      <ul>
        <li><a href="http://try.dartlang.org">Dartboard</a></li>
        <li><a href="/docs/getting-started/editor/">Dart Editor</a></li>
        <li><a href="/dartium/">Chromium with the Dart VM</a></li>
        <li><a href="/docs/getting-started/sdk/">SDK</a></li>
      </ul> </li>
    <li>Resources
      <ul>
        <li><a href="/samples/">Code Samples</a></li>
        <li><a href="/articles/">Articles</a></li>
        <li><a href="/slides/">Presentations</a></li>
        <li><a href="/support/faq.html">FAQ</a></li>
        <li><a href="/resources/">More</a></li>
      </ul> </li>
    <li><a href="/support/">Contact Us</a></li>
  </ul>

 


<article>
<h1> Dart ぱずらーず 1</h1>
<em>著 Joshua Bloch 訳 Usagi Ito <br />
2012年 1月（訳 2012年 3月）</em>

<section>

<p> もう何年も前に、私は<em>Java ぱずらーず: ワナと落とし穴と重箱の隅と</em>（訳註: ）という本を共同執筆した。 そして今、私は
Dart チームに居て、その Java ぱずらーずの全てを Dart へと翻訳しようとしている。この試みがパズルを求める誰かさんや、Dart
の設計に関する有用な知見としてお役に立てれば幸いである。 それでは、さっそく最初の章へと迷い込むとしよう。  </p>

<section id="toc">
<h4> もくじ </h4>
<ol class="toc">
  <li> <a href="#1">ぱずらー 1: 奇数かな</a> </li>
  <li> <a href="#2">ぱずらー 2: 変革の時</a> </li>
  <li> <a href="#3">ぱずらー 3: 割り算の筆算</a> </li>
  <li> <a href="#4">ぱずらー 4: このくらい基礎だよね</a> </li>
  <li> <a href="#5">ぱずらー 5: １６進あそび</a> </li>
  <li> <a href="#6">ぱずらー 6: マルチキャスト</a> </li>
  <li> <a href="#7">ぱずらー 7: お肉の交換</a> </li>
  <li> <a href="#8">ぱずらー 8: ドス エキス(訳註: Dos Equis; スペイン語で２つのエックス)</a> </li>
  <li> <a href="#9">ぱずらー 9: トゥィードルダム(訳註: 鏡の国のアリアス)</a> </li>
  <li> <a href="#10">ぱずらー 10: トゥィードルディー(訳註: 鏡の国のアリアス)</a> </li>
  <li> <a href="#summary">まとめ！</a> </li>
</ol>
</section>

<h2 id="1"> ぱずらー 1: 奇数かな </h2>

<p> 次に示すJavaのメソッドでは引数が偶数か奇数かを表示するよ。でも、引数が負の奇数だと失敗しちゃうんだ。: </p>

<pre class="prettyprint lang-java linenums:0 ">
public static boolean isOdd(int i) {
  return i % 2 == 1;
}
</pre>

<p> このパズルをDartにしてみよう:
Dartではこの様な関数も<em>きっちり</em>と奇数を判定してくれる（Javaとは違った挙動をするよ）: : </p>

<pre class="prettyprint lang-java linenums:0 ">
bool isOdd(int i) {
  return i % 2 == 1;
}
</pre>

<p> That said, I'm not so sure the cure is any better than the disease; the
resulting arithmetic violates the "Division Rule": </p>

<blockquote> D = d * (D div d) + D mod d </blockquote>

<p> It’s also incompatible with JavaScript, Java, C, C++, and C#.  I've been
discussing this issue with <a href="/authors/florian-loitsch.html">Florian
Loitsch</a>.  </p>


<h2 id="2"> Puzzler 2: Time for a Change </h2>

<p> This program appears to calculate the change when $2.00 is paid for a
$0.90 purchase.  </p>

<pre class="prettyprint lang-java linenums:0 ">
public class Change {
  public static void main(String args[]) {
    System.out.println(2.00 - 1.10);
  }
}
</pre>

<p> Here it is translated into Dart: </p>

<pre class="prettyprint lang-dart linenums:0 ">
main() {
  print(2.00 - 1.10);
}
</pre>

<p> In Java and Dartboard, it prints 0.8999999999999999.  Using the Dart VM,
it (currently) prints 0.9, but this is because we’re currently using C’s
formatting functions; in the near future, the Dart VM will display the same
(puzzling) behavior as Dartboard.  </p>

<p> This raises the question, should Dart support decimal floating point
arithmetic natively? There are many who would argue that it should.  One man
(Mike Cowlishaw, former IBM Fellow)  devoted a good chunk of his life to
this: <a
href="http://speleotrove.com/decimal">http://speleotrove.com/decimal</a>.
C# does support 128-bit floating decimals, for what it’s worth.  But if
you’re deploying to JavaScript, floating-point decimal arithmetic will be
ungodly slow, and it won’t be fast anywhere (except, perhaps, on IBM’s
Power6 chip, which supports floating decimal natively, due to the efforts of
the aforementioned Mike Cowlishaw).  Incidentally, Cowlishaw was on the
EcmaScript committee, and did get decimal arithmetic into the ill-fated
EcmaScript 4.  </p>

<p> If Dart does provide library support for floating point decimal
arithmetic, should we provide linguistic support for decimal literals? </p>

<p> As you’re doubtless aware, the floating point binary problem is worse in
Dart than when you compile to JavaScript.  In Java, most programmers know
enough to use int rather than double to avoid these problems.  But consider
the following Dart program: </p>

<pre class="prettyprint lang-dart linenums:0 ">
main() {
  int i = 1000 * 1000 * 1000 * 1000 * 1000 * 1000 * 1000 * 1000;
  print(i == i + 1);
}
</pre>

<p> When you run it on Dartboard, it prints true, which is <em>really</em>
confusing.  I don’t think we can, in good conscience, support this
behavior.  But I understand that this is a hard, over-constrained problem.
</p>


<h2 id="3"> Puzzler 3: Long Division </h2>

<p> This Java program would appear to print the number of microseconds per
millisecond, which is 1000.  In fact, it prints 5: </p>

<pre class="prettyprint lang-java linenums:0 ">
public class LongDivision {
  public static void main(String[] args) {
    final long MICROS_PER_DAY = 24 * 60 * 60 * 1000 * 1000;
    final long MILLIS_PER_DAY = 24 * 60 * 60 * 1000;

    System.out.println(MICROS_PER_DAY / MILLIS_PER_DAY);
  }
}
</pre>

<p> This puzzler doesn’t apply directly to Dart because it has no long type,
and was fixed because Dart's int type is arbitrary-precision.  If you label
the variables as int, the correct answer is printed (1000).  Dartboard
happens to calculate the correct value in this case, but there's no
guarantee that it will do so in general.  </p>


<h2 id="4"> Puzzler 4: It's Elementary </h2>

<pre class="prettyprint lang-java linenums:0 ">
public class Elementary {
  public static void main(String[] args) {
    System.out.println(12345 + 5432l); // Lowercase L masquerades as 1!
  }
}
</pre>

<p> This puzzler doesn’t apply to Dart, as there are no long (64-bit)
literals in Dart.  </p>


<h2 id="5"> Puzzler 5: The Joy of Hex </h2>

<p> This Java program looks like it should print <code>1cafebabe</code> but
actually prints <code>cafebabe</code> due to unexpected sign extension
(<code>0xcafebabe</code> is a negative number).

<pre class="prettyprint lang-java linenums:0 ">
public class JoyOfHex {
  public static void main(String[] args) {
    System.out.println(
      Long.toHexString(0x100000000L + 0xcafebabe));
  }
}
</pre>

<p> This was fixed in Dart, by the use of arbitrary-precision integer
arithmetic.  This Dart program prints <code>1cafebabe</code>: </p>

<pre class="prettyprint lang-dart linenums:0 ">
main() {
  print((0x100000000 + 0xcafebabe).toRadixString(16));
}
</pre>


<h2 class="6"> Puzzler 6: Multicast </h2>

<pre class="prettyprint lang-java linenums:0 ">
public class Multicast {
  public static void main(String[] args) {
    System.out.println((int) (char) (byte) -1);
  }
}
</pre>

<p> This puzzle doesn't apply in Dart as it has no casts.  </p>


<h2 class="7"> Puzzler 7: Swap Meat </h2>

<p> This program attempts to use a hideous hack to swap the contents of two
int variables: </p>

<pre class="prettyprint lang-java linenums:0 ">
public class CleverSwap {
  public static void main(String[] args) {
    int x = 1984;
    int y = 2001;
    x ^= y ^= x ^= y;
    System.out.println("x = " + x + "; y = " + y);
  }
}
</pre>

<p> In Dart: </p>

<pre class="prettyprint lang-dart linenums:0 ">
main() {
  int x = 1984;
  int y = 2001;
  x ^= y ^= x ^= y;
  print("x = ${x}; y = ${y}");
}
</pre>

<p> This puzzler behaves exactly the same in Java and Dart.  Luckily, it
doesn't indicate a language problem: It's just a cautionary tale regarding
overly clever programming and premature optimization.  (For what it’s worth,
the Rube Goldberg “fix” in the book also applies equally well to Dart and
Java.)  </p>


<h2 id="8"> Puzzler 8: Dos Equis </h2>

<p> This program would appear to print <code>XX</code>, but actually prints
<code>X88</code> in Java: </p>

<pre class="prettyprint lang-java linenums:0 ">
public class DosEquis {
  public static void main(String[] args) {
    char x = 'X';
    int i = 0;
    System.out.print(true  ? x : 0);
    System.out.print(false ? i : x);
  }
}
</pre>

<p> In Dart: </p>

<pre class="prettyprint lang-dart linenums:0 ">
main() {
  string x = 'X';
  int i = 0;
  print(true  ? x : 0);
  print(false ? i : x);
}
</pre>

<p> This puzzle is fixed in Dart, because Dart doesn’t have a char type that
is a (barely) glorified int type, doesn’t do primitive widening conversions
on ternary expressions, and doesn't have weird rules concerning small int
values (don't ask; read the book if you’re morbidly curious).  </p>


<h2 id="#9"> Puzzler 9: Tweedledum </h2>

<p> In this puzzle, you’re asked to provide declarations to cause the
indicated behavior: </p>

<pre class="prettyprint lang-java linenums:0 ">
Public class Tweedledum {
  public static void main(String[] args) {
    // Put your declarations for x and i here

    x += i;     // Must be LEGAL
    x = x + i;  // Must be ILLEGAL
  }
}
</pre>

<p> Fixed in Dart: no short type, no implicit narrowing conversion on
compound assignment expressions.  </p>


<h2 id="10"> Puzzler 10: Tweedledee </h2>

<p> Again, you’re asked to provide declarations to cause the indicated
behavior: </p>

<pre class="prettyprint lang-java linenums:0 ">
public class Tweedledee {
  public static void main(String[] args) {
    // Put your declarations for x and i here

    x = x + i;  // Must be LEGAL
    x += i;     // Must be ILLEGAL
  }
}
</pre>

<p> This one is fixed in Dart; in fact, it’s even fixed in Java, as of 1.6.
It had to do with peculiarities of Java's String concatenation operator and
its corresponding compound assignment operator.  </p>

<h2 id="summary"> Summary </h2>

<p> Out of ten Java puzzlers, eight have been fixed in Dart, one (Puzzler 3)
arguably made worse (it's easier to get into floating point binary
troubles), and one doesn't really indicate a language problem (Puzzler 7).
</p>

</section>

 

</article>
		
<footer>
  <p>
    ライセンス:
      ページ <a href="http://creativecommons.org/licenses/by/3.0/">CC-BY(3.0)</a>
      コード <a href="http://code.google.com/google_bsd_license.html">BSD License</a>
  </p>
  <p>
    この記事は
    <a href="http://www.dartlang.org/articles/puzzlers/chapter-1.html">Dart Puzzlers Chapter 1</a>
    を元に
    <a href="https://sites.google.com/site/dartrefjp/">dartrefjp</a> / 
    <a href="usagi@WonderRabbitProject.net">伊藤 兎</a>
    が邦訳したものです。
  </p>
</footer>

 

 
	
 

 

